<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>数据库系统 | JACKY</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/2.10.0/github-markdown.min.css">
    <link rel="stylesheet" href="/css/index.css">
    <link rel="icon" href="/images/logo.png">
    <meta name="description" content="">
    
    <link rel="preload" href="/assets/css/0.styles.181f12b1.css" as="style"><link rel="preload" href="/assets/js/app.f60bcc2c.js" as="script"><link rel="preload" href="/assets/js/2.bad792ca.js" as="script"><link rel="preload" href="/assets/js/15.71e61a0e.js" as="script"><link rel="prefetch" href="/assets/js/10.3870dfc9.js"><link rel="prefetch" href="/assets/js/100.33789d0d.js"><link rel="prefetch" href="/assets/js/101.720e9545.js"><link rel="prefetch" href="/assets/js/102.0d46e59f.js"><link rel="prefetch" href="/assets/js/103.cf779584.js"><link rel="prefetch" href="/assets/js/104.c9ebede1.js"><link rel="prefetch" href="/assets/js/105.320a9546.js"><link rel="prefetch" href="/assets/js/106.e6805173.js"><link rel="prefetch" href="/assets/js/11.a6ea81b6.js"><link rel="prefetch" href="/assets/js/12.4bb4b38d.js"><link rel="prefetch" href="/assets/js/13.a8729ae5.js"><link rel="prefetch" href="/assets/js/14.88f89f42.js"><link rel="prefetch" href="/assets/js/16.7267174c.js"><link rel="prefetch" href="/assets/js/17.4f829a89.js"><link rel="prefetch" href="/assets/js/18.03ec02b6.js"><link rel="prefetch" href="/assets/js/19.84bfd456.js"><link rel="prefetch" href="/assets/js/20.3b51b944.js"><link rel="prefetch" href="/assets/js/21.186891ef.js"><link rel="prefetch" href="/assets/js/22.fee81424.js"><link rel="prefetch" href="/assets/js/23.d0aac5b9.js"><link rel="prefetch" href="/assets/js/24.6b69cfe2.js"><link rel="prefetch" href="/assets/js/25.c66af061.js"><link rel="prefetch" href="/assets/js/26.f6dbd423.js"><link rel="prefetch" href="/assets/js/27.4b120a99.js"><link rel="prefetch" href="/assets/js/28.0d925b0c.js"><link rel="prefetch" href="/assets/js/29.3b765d1c.js"><link rel="prefetch" href="/assets/js/3.b1f3d5f9.js"><link rel="prefetch" href="/assets/js/30.04c71f4a.js"><link rel="prefetch" href="/assets/js/31.3fd9262e.js"><link rel="prefetch" href="/assets/js/32.181e3c1d.js"><link rel="prefetch" href="/assets/js/33.b55218e6.js"><link rel="prefetch" href="/assets/js/34.c495c048.js"><link rel="prefetch" href="/assets/js/35.eb762b8c.js"><link rel="prefetch" href="/assets/js/36.63ad4fbe.js"><link rel="prefetch" href="/assets/js/37.8663a4c1.js"><link rel="prefetch" href="/assets/js/38.2d05d18d.js"><link rel="prefetch" href="/assets/js/39.efc12a85.js"><link rel="prefetch" href="/assets/js/4.c0e92c37.js"><link rel="prefetch" href="/assets/js/40.925f57db.js"><link rel="prefetch" href="/assets/js/41.b3c0c5bb.js"><link rel="prefetch" href="/assets/js/42.1c1f9d9a.js"><link rel="prefetch" href="/assets/js/43.43c0bd60.js"><link rel="prefetch" href="/assets/js/44.c6df2236.js"><link rel="prefetch" href="/assets/js/45.1741c663.js"><link rel="prefetch" href="/assets/js/46.57e5bc75.js"><link rel="prefetch" href="/assets/js/47.9b059617.js"><link rel="prefetch" href="/assets/js/48.cd1e17f8.js"><link rel="prefetch" href="/assets/js/49.34700620.js"><link rel="prefetch" href="/assets/js/5.762ede0d.js"><link rel="prefetch" href="/assets/js/50.75eaa7f3.js"><link rel="prefetch" href="/assets/js/51.a40454fa.js"><link rel="prefetch" href="/assets/js/52.d5f7c3a5.js"><link rel="prefetch" href="/assets/js/53.d1164390.js"><link rel="prefetch" href="/assets/js/54.056dd2b2.js"><link rel="prefetch" href="/assets/js/55.190196c0.js"><link rel="prefetch" href="/assets/js/56.b548448c.js"><link rel="prefetch" href="/assets/js/57.96f33ef6.js"><link rel="prefetch" href="/assets/js/58.d2d99324.js"><link rel="prefetch" href="/assets/js/59.42c4e143.js"><link rel="prefetch" href="/assets/js/6.eb959d0b.js"><link rel="prefetch" href="/assets/js/60.caa709e5.js"><link rel="prefetch" href="/assets/js/61.0d4d2549.js"><link rel="prefetch" href="/assets/js/62.4160b095.js"><link rel="prefetch" href="/assets/js/63.ec1f97e1.js"><link rel="prefetch" href="/assets/js/64.204c4d91.js"><link rel="prefetch" href="/assets/js/65.35e3e36c.js"><link rel="prefetch" href="/assets/js/66.22a4c023.js"><link rel="prefetch" href="/assets/js/67.99bf4edf.js"><link rel="prefetch" href="/assets/js/68.e7d4433f.js"><link rel="prefetch" href="/assets/js/69.3ad43e4a.js"><link rel="prefetch" href="/assets/js/7.02f12834.js"><link rel="prefetch" href="/assets/js/70.8a867480.js"><link rel="prefetch" href="/assets/js/71.81dd9524.js"><link rel="prefetch" href="/assets/js/72.ab573144.js"><link rel="prefetch" href="/assets/js/73.495bc942.js"><link rel="prefetch" href="/assets/js/74.d823be33.js"><link rel="prefetch" href="/assets/js/75.99f73d3f.js"><link rel="prefetch" href="/assets/js/76.dd1da660.js"><link rel="prefetch" href="/assets/js/77.3e5e36a8.js"><link rel="prefetch" href="/assets/js/78.051f8446.js"><link rel="prefetch" href="/assets/js/79.2d4b4180.js"><link rel="prefetch" href="/assets/js/8.e564c2ce.js"><link rel="prefetch" href="/assets/js/80.b26f37e5.js"><link rel="prefetch" href="/assets/js/81.628c5e4f.js"><link rel="prefetch" href="/assets/js/82.14b92cb9.js"><link rel="prefetch" href="/assets/js/83.695e8ef3.js"><link rel="prefetch" href="/assets/js/84.2dac3d18.js"><link rel="prefetch" href="/assets/js/85.80b287fd.js"><link rel="prefetch" href="/assets/js/86.b79b0692.js"><link rel="prefetch" href="/assets/js/87.aa942b96.js"><link rel="prefetch" href="/assets/js/88.ab91faa2.js"><link rel="prefetch" href="/assets/js/89.8b2cabda.js"><link rel="prefetch" href="/assets/js/9.d9599932.js"><link rel="prefetch" href="/assets/js/90.ad36d54b.js"><link rel="prefetch" href="/assets/js/91.9d368a46.js"><link rel="prefetch" href="/assets/js/92.47cf969d.js"><link rel="prefetch" href="/assets/js/93.bce74186.js"><link rel="prefetch" href="/assets/js/94.e74453fd.js"><link rel="prefetch" href="/assets/js/95.a7ef6466.js"><link rel="prefetch" href="/assets/js/96.2fcbed97.js"><link rel="prefetch" href="/assets/js/97.c51bd04f.js"><link rel="prefetch" href="/assets/js/98.5d1c6779.js"><link rel="prefetch" href="/assets/js/99.3d3196a0.js">
    <link rel="stylesheet" href="/assets/css/0.styles.181f12b1.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">JACKY</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/" aria-current="page" class="sidebar-link">/</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Linux操作系统</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>专业课</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/专业课/凸优化.html" class="sidebar-link">凸优化</a></li><li><a href="/专业课/操作系统.html" class="sidebar-link">操作系统</a></li><li><a href="/专业课/数学基础.html" class="sidebar-link">数学汇总</a></li><li><a href="/专业课/数据库系统.html" class="active sidebar-link">数据库系统</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/专业课/数据库系统.html#什么是数据独立性" class="sidebar-link">什么是数据独立性</a></li><li class="sidebar-sub-header"><a href="/专业课/数据库系统.html#数据库三大范式" class="sidebar-link">数据库三大范式</a></li><li class="sidebar-sub-header"><a href="/专业课/数据库系统.html#数据库的完整性约束" class="sidebar-link">数据库的完整性约束</a></li><li class="sidebar-sub-header"><a href="/专业课/数据库系统.html#并发带来的数据不一致" class="sidebar-link">并发带来的数据不一致</a></li><li class="sidebar-sub-header"><a href="/专业课/数据库系统.html#恢复策略" class="sidebar-link">恢复策略</a></li><li class="sidebar-sub-header"><a href="/专业课/数据库系统.html#acid" class="sidebar-link">ACID</a></li><li class="sidebar-sub-header"><a href="/专业课/数据库系统.html#dql" class="sidebar-link">DQL</a></li><li class="sidebar-sub-header"><a href="/专业课/数据库系统.html#myisam-和-innodb" class="sidebar-link">MyISAM 和 InnoDB</a></li><li class="sidebar-sub-header"><a href="/专业课/数据库系统.html#锁" class="sidebar-link">锁</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/专业课/数据库系统.html#意向锁" class="sidebar-link">意向锁</a></li></ul></li><li class="sidebar-sub-header"><a href="/专业课/数据库系统.html#备份" class="sidebar-link">备份</a></li><li class="sidebar-sub-header"><a href="/专业课/数据库系统.html#执行流程" class="sidebar-link">执行流程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/专业课/数据库系统.html#第一步-连接器" class="sidebar-link">第一步：连接器</a></li><li class="sidebar-sub-header"><a href="/专业课/数据库系统.html#第二步-查询缓存-select" class="sidebar-link">第二步：查询缓存（select）</a></li><li class="sidebar-sub-header"><a href="/专业课/数据库系统.html#第三步-解析sql" class="sidebar-link">第三步：解析SQL</a></li><li class="sidebar-sub-header"><a href="/专业课/数据库系统.html#第四步-执行sql" class="sidebar-link">第四步：执行SQL</a></li></ul></li><li class="sidebar-sub-header"><a href="/专业课/数据库系统.html#数据存储" class="sidebar-link">数据存储</a></li></ul></li><li><a href="/专业课/计算机组成原理.html" class="sidebar-link">计算机组成原理</a></li><li><a href="/专业课/计算机网络.html" class="sidebar-link">计算机网络</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>机器学习</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>深度学习</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>硬件设计</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>算法与数据结构</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>编程语言</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>联邦学习</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>软件开发</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="数据库系统"><a href="#数据库系统" class="header-anchor">#</a> 数据库系统</h1> <h2 id="什么是数据独立性"><a href="#什么是数据独立性" class="header-anchor">#</a> 什么是数据独立性</h2> <p>数据独立性：分为 逻辑独立性和物理独立性</p> <p>逻辑独立性：当模式改变时，通过对各个外模式/模式映像的调整，使外模式保持不变，使得应用程序不需要做任何修改。</p> <p>物理独立性：当内模式改变时，通过对模式/内模式映像的调整，使模式保持不变，使得应用程序不需要做任何修改。</p> <p>ps：内模式、模式只有一个，外模式有多个。</p> <h2 id="数据库三大范式"><a href="#数据库三大范式" class="header-anchor">#</a> 数据库三大范式</h2> <blockquote><p>第一范式(1NF)：<strong>属性不可分割</strong>，即每个属性都是不可分割的原子项。(实体的属性即表中的列)</p> <p>第二范式(2NF)：满足第一范式；且不存在<strong>部分依赖</strong>，即非主属性必须完全依赖于主属性。(主属性即主键；完全依赖是针对于联合主键的情况，非主键列不能只依赖于主键的一部分)</p> <p>第三范式(3NF)：满足第二范式；且不存在<strong>传递依赖</strong>，即非主属性不能与非主属性之间有依赖关系，非主属性必须直接依赖于主属性，不能间接依赖主属性。（A -&gt; B, B -&gt;C, A -&gt; C）</p></blockquote> <h2 id="数据库的完整性约束"><a href="#数据库的完整性约束" class="header-anchor">#</a> 数据库的完整性约束</h2> <p>实体完整性：主属性非空</p> <p>参照完整性：外码取空值或关系中的主码值</p> <p>用户定义的完整性：unique，check，not null</p> <h2 id="并发带来的数据不一致"><a href="#并发带来的数据不一致" class="header-anchor">#</a> 并发带来的数据不一致</h2> <ol><li><p>丢失修改</p> <p>T2提交的结果破坏了T1提交的结果</p></li> <li><p>不可重复读</p> <p>T1读该值，T2给她修改了，导致T1无法再现前一次读的结果</p></li> <li><p>读脏数据</p> <p>T1修改其值并写回，T2去读该值，然后T1回滚了。</p></li></ol> <p>两种锁：X锁和S锁（也叫写锁和读锁）</p> <ul><li>X锁：只允许T读A和修改A，任和锁其他食物都不能加</li> <li>S锁：允许T读A但不能修改A，其他事务只能对A加S锁。</li></ul> <p>封锁协议：</p> <ul><li><p>一级封锁：解决的是“丢失修改的问题”</p> <p>​				事务T在修改数据R之前必须加上X锁</p></li> <li><p>二级封锁：解决的是“丢失修改”+“读脏数据”的问题</p> <p>​				在一级封锁的基础上，增加T在读取R之前加S锁，读完释放</p></li> <li><p>三级封锁：解决的是“丢失修改”+“读脏数据”+“不可重复读“</p> <p>​				在一级封锁的基础上，增加T在读取R之前加S锁，事务结束后才释放</p></li></ul> <h2 id="恢复策略"><a href="#恢复策略" class="header-anchor">#</a> 恢复策略</h2> <ul><li><p>事务故障</p> <p>采用UNDO，反向扫描日志文件，进行逆操作，直至事务的开始标记。</p></li> <li><p>系统故障</p> <p>REDO+UNDO</p> <p>正向扫描，对故障发生之前已经提交的事务加入REDO-list；对于未完成的事务加入UNDO-list；</p></li></ul> <h2 id="acid"><a href="#acid" class="header-anchor">#</a> ACID</h2> <p>原子性：每个操作原子不可再分</p> <p>一致性：数据库操作前后数据库的正确性保持一致</p> <p>隔离性：多个并发<strong>事务</strong>之间要相互<strong>隔离</strong></p> <p>持久性：入库后，就永久更新</p> <h2 id="dql"><a href="#dql" class="header-anchor">#</a> DQL</h2> <p>join默认是内连接，也被称为自然连接</p> <p>inner join：两个表值都存在</p> <p>outer join：附表中值可能存在null的情况。</p> <div class="language-mysql extra-class"><pre class="language-text"><code>select FirstName,LastName,City,State 
from Person left join Address
on Person.PersonId = Address.PersonId
</code></pre></div><p>limit不支持运算，所以不能直接N-1，需要先声明一个int型变量m，并且set他的值为N-1。
另外，这题不需要再为列起别名，因为在一个函数里，这个函数返回的是一个int值，那么后台在调用这个函数时，返回的列名就是——函数名(N)</p> <div class="language-mysql extra-class"><pre class="language-text"><code>CREATE FUNCTION getNthHighestSalary(N INT) RETURNS INT
BEGIN
set N = N-1;
  RETURN (
      # Write your MySQL query statement below.
        select(
          select distinct salary
          from Employee
          order by salary desc
          limit N, 1
      ) as getNthHighestSalary
  );
END
</code></pre></div><p>limit
<code>select * from product limit 3;</code></p> <p>limit只有一个参数值，将表中的前三条数据查询出来</p> <p><code>select * from product limit 3,2;</code></p> <p>limit有两个参数，第一个参数表示从第（几+1）行数据开始查，第二个参数表示查几条数据，“limit 3,2”表示从第四行数据开始，取两条数据。</p> <blockquote><p>1、select* from user limit 3</p> <p>表示直接取前三条数据</p> <p>2、select * from user limit 1,3;</p> <p>表示取1后面的第2,3,4三条条数据</p> <p>3、select * from user limit 3 offset 1;</p> <p>表示取1后面第2,3,4三条条数据</p></blockquote> <p>使用变量前，需要先declare</p> <p><code>declare m INT</code></p> <p><code>dateDiff(b.recordDate,a.recordDate)=1</code></p> <ol><li><p>rank() over
作用：查出指定条件后的进行排名，条件相同排名相同，排名间断不连续。
说明：例如学生排名，使用这个函数，成绩相同的两名是并列，下一位同学空出所占的名次。即：1 1 3 4 5 5 7</p></li> <li><p>dense_rank() over
作用：查出指定条件后的进行排名，条件相同排名相同，排名间断不连续。
说明：和rank() over 的作用相同，区别在于dense_rank() over 排名是密集连续的。例如学生排名，使用这个函数，成绩相同的两名是并列，下一位同学接着下一个名次。即：1 1 2 3 4 5 5 6</p></li> <li><p>row_number() over
作用：查出指定条件后的进行排名，条件相同排名也不相同，排名间断不连续。
说明：这个函数不需要考虑是否并列，即使根据条件查询出来的数值相同也会进行连续排序。即：1 2 3 4 5 6</p></li></ol> <div class="language-mysql extra-class"><pre class="language-text"><code># Write your MySQL query statement below
select score, dense_rank() over (order by score desc) as 'rank'  
from scores;
#这个rank之所以要加引号，因为rank本身是个函数，直接写rank会报错
</code></pre></div><p>where&gt;group by&gt;having&gt;order by</p> <div class="language- extra-class"><pre><code>	1、from
	2、on
	3、join
---------------------确定表
	4、where
	5、group by
	6、having
---------------------确定筛选条件
	7、select
	8、distinct
---------------------确定显示字段
	9、order by
	10、limit
---------------------确定显示效果
</code></pre></div><p><img src="https://s2.loli.net/2022/12/08/viQtXSw9qsuFx7o.png" alt="img"></p> <h2 id="myisam-和-innodb"><a href="#myisam-和-innodb" class="header-anchor">#</a> MyISAM 和 InnoDB</h2> <p>行级锁与表级锁</p> <ul><li><p>MyISAM 仅仅支持表级锁(table-level locking)，一锁就锁整张表，这在并发写的情况下性非常差。<strong>不支持事务</strong></p></li> <li><p>InnoDB 不光支持表级锁(table-level locking)，还支持行级锁(row-level locking)，默认为行级锁。行级锁的粒度更小，仅对相关的记录上锁即可（对一行或者多行记录加锁），所以对于并发写入操作来说， InnoDB 的性能更高</p></li> <li><p><strong>表级锁：</strong> MySQL 中锁定粒度最大的一种锁，是针对非索引字段加的锁，对当前操作的整张表加锁，实现简单，资源消耗也比较少，加锁快，不会出现死锁。其锁定粒度最大，触发锁冲突的概率最高，并发度最低，MyISAM 和 InnoDB 引擎都支持表级锁。</p></li> <li><p><strong>行级锁：</strong> MySQL 中锁定粒度最小的一种锁，是针对索引字段加的锁，只针对当前操作的行记录进行加锁。 行级锁能大大减少数据库操作的冲突。其加锁粒度最小，并发度高，但加锁的开销也最大，加锁慢，会出现死锁。</p></li></ul> <h2 id="锁"><a href="#锁" class="header-anchor">#</a> 锁</h2> <p>不论是表级锁还是行级锁，都存在共享锁（Share Lock，S 锁）和排他锁（Exclusive Lock，X 锁）这两类：</p> <ul><li><strong>共享锁（S 锁）</strong> ：又称读锁，事务在读取记录的时候获取共享锁，允许多个事务同时获取（锁兼容）。</li> <li><strong>排他锁（X 锁）</strong> ：又称写锁/独占锁，事务在修改记录的时候获取排他锁，不允许多个事务同时获取。如果一个记录已经被加了排他锁，那其他事务不能再对这条事务加任何类型的锁（锁不兼容）。</li></ul> <p>排他锁与任何的锁都不兼容，共享锁仅和共享锁兼容。</p> <table><thead><tr><th style="text-align:left;"></th> <th style="text-align:left;">S 锁</th> <th style="text-align:left;">X 锁</th></tr></thead> <tbody><tr><td style="text-align:left;">S 锁</td> <td style="text-align:left;">不冲突</td> <td style="text-align:left;">冲突</td></tr> <tr><td style="text-align:left;">X 锁</td> <td style="text-align:left;">冲突</td> <td style="text-align:left;">冲突</td></tr></tbody></table> <h3 id="意向锁"><a href="#意向锁" class="header-anchor">#</a> 意向锁</h3> <p>意向锁可以帮助快速判断是否可以对一个表使用表锁（因为如果要加表锁的话，要求表内没有行锁，并且表没有表锁）</p> <p>意向锁是表级锁，共有两种：</p> <ul><li><strong>意向共享锁（IS 锁）</strong>：事务有意向对表中的某些记录加共享锁（S 锁），加共享锁前必须先取得该表的 IS 锁。</li> <li><strong>意向排他锁（IX 锁）</strong>：事务有意向对表中的某些记录加排他锁（X 锁），加排他锁之前必须先取得该表的 IX 锁。</li></ul> <p>在为数据行加共享 / 排他锁之前，InooDB 会先获取该数据行所在在数据表的对应意向锁。</p> <h2 id="备份"><a href="#备份" class="header-anchor">#</a> 备份</h2> <p><code>mysqldump -h主机名 -P端口 -u用户名 -p密码 –database 数据库名 &gt; 文件名.sql</code></p> <h2 id="执行流程"><a href="#执行流程" class="header-anchor">#</a> 执行流程</h2> <p><img src="https://s2.loli.net/2022/12/09/FkrGZxH164p8KwJ.png" alt="img"></p> <h3 id="第一步-连接器"><a href="#第一步-连接器" class="header-anchor">#</a> 第一步：连接器</h3> <p>mysql是基于tcp协议进行传输的</p> <p>mysql是默认长连接，8h 空闲连接</p> <p>最多连接数，151个</p> <h3 id="第二步-查询缓存-select"><a href="#第二步-查询缓存-select" class="header-anchor">#</a> 第二步：查询缓存（select）</h3> <p>MySQL 服务收到 SQL 语句后，<strong>就会解析出 SQL 语句的第一个字段，看看是什么类型的语句。</strong></p> <p>如果 SQL 是查询语句（select 语句），<strong>MySQL 就会先去查询缓存（ Query Cache ）里查找缓存数据</strong>，看看之前有没有执行过这一条命令，这个查询缓存是以 key-value 形式保存在内存中的，key 为 SQL 查询语句，value 为 SQL 语句查询的结果。</p> <h3 id="第三步-解析sql"><a href="#第三步-解析sql" class="header-anchor">#</a> 第三步：解析SQL</h3> <p>词法分析</p> <p>语法分析</p> <h3 id="第四步-执行sql"><a href="#第四步-执行sql" class="header-anchor">#</a> 第四步：执行SQL</h3> <p><strong>预处理</strong></p> <p><strong>优化器</strong></p> <p>要想知道优化器选择了哪个索引，我们可以在查询语句最前面加个 <code>explain</code> 命令（常用于排查慢sql的原因），这样就会输出这条 SQL 语句的执行计划，然后执行计划中的 key 就表示执行过程中使用了哪个索引，比如下图的 key 为 <code>PRIMARY</code> 就是使用了主键索引。</p> <p><img src="https://s2.loli.net/2022/12/09/otqEX19NC5ypciG.png" alt="img"></p> <p>key如果是null，那就执行全表扫描</p> <p><strong>执行</strong></p> <h2 id="数据存储"><a href="#数据存储" class="header-anchor">#</a> 数据存储</h2> <p>我们每创建一个 database（数据库） 都会在 /var/lib/mysql/ 目录里面创建一个以 database 为名的目录，然后保存表结构和表数据的文件都会存放在这个目录里。</p> <p>比如，我这里有一个名为 my_test 的 database，该 database 里有一张名为 t_order 数据库表。</p> <p><img src="https://s2.loli.net/2022/12/09/jN6vIxpE2mGuM4Z.png" alt="img"></p> <p>然后，我们进入 /var/lib/mysql/my_test 目录，看看里面有什么文件？</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@xiaolin ~<span class="token punctuation">]</span><span class="token comment">#ls /var/lib/mysql/my_test</span>
db.opt  
t_order.frm  
t_order.ibd
</code></pre></div><p>可以看到，共有三个文件，这三个文件分别代表着：</p> <ul><li>db.opt，用来存储当前数据库的默认字符集和字符校验规则。</li> <li>t_order.frm ，t_order 的<strong>表结构</strong>会保存在这个文件。在 MySQL 中建立一张表都会生成一个.frm 文件，该文件是用来保存每个表的元数据信息的，主要包含表结构定义。</li> <li>t_order.ibd，t_order 的<strong>表数据</strong>会保存在这个文件。 MySQL 中每一张表的数据都存放在一个独立的 .idb 文件。</li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/专业课/数学基础.html" class="prev">
        数学汇总
      </a></span> <span class="next"><a href="/专业课/计算机组成原理.html">
        计算机组成原理
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.f60bcc2c.js" defer></script><script src="/assets/js/2.bad792ca.js" defer></script><script src="/assets/js/15.71e61a0e.js" defer></script>
  </body>
</html>
